<polymer-element name="twittargh-sign-in">

    <template>
        <style>

            core-toolbar {
                font-size: 26px;
                color: white;
            }

            #sign-in-form {
                background-color: white;

                width: 350px;
                height: 300px;
            }

            paper-input-decorator, #submit {
                margin: 20px;
            }

            #submit core-icon {
                margin-left: 10px;
            }

            paper-spinner {
                width: 75px;
                height: 75px;
            }

            paper-spinner /deep/ .circle {
                border-width: 5px;
            }

        </style>

        <twittargh-globals id="globals"></twittargh-globals>

        <div layout horizontal center-justified fit>

            <paper-shadow self-center layout vertical id="sign-in-form" z="3">
                <core-toolbar>
                    Twitt<span style="margin: 0px; color: #FF1929; font-weight: bold;">argh !</span>
                </core-toolbar>

                <template if="{{!signingIn}}" id="sign-in-form">

                    <div flex layout horizontal>
                        <paper-input-decorator flex self-center id="username" label="Username" floatinglabel="true">
                            <input type="text" is="core-input" value="{{username}}">
                        </paper-input-decorator>
                    </div>
                    <div flex layout horizontal>
                        <paper-input-decorator flex self-center id="password" label="Password" floatinglabel="true">
                            <input type="password" is="core-input" value="{{password}}">
                        </paper-input-decorator>
                    </div>
                    <div flex layout horizontal>
                        <paper-button on-click="{{signIn}}" id="submit" flex self-center raised>
                            Connexion
                            <core-icon icon="arrow-forward"></core-icon>
                        </paper-button>
                    </div>

                </template>

                <template if="{{signingIn}}" id="sign-in-form">
                    <div flex layout horizontal center-justified>
                        <div self-center>
                            <paper-spinner active></paper-spinner>
                        </div>
                    </div>
                </template>

            </paper-shadow>

            <core-ajax
                    id="ajaxSignIn"
                    url="/api/signIn?username={{username}}&password={{password}}"
                    method="GET"
                    handleAs="json"
                    on-core-response="{{signInResponse}}"
                    on-core-error="{{signInResponse}}">
            </core-ajax>
        </div>
    </template>

    <script>

        Polymer('twittargh-sign-in', {

            signingIn: false,
            username: "",
            password: "",

            signIn: function() {
                this.signingIn = true;
            },

            log: function () {
                console.log(this.$.globals.values.user);
                this.$.globals.values.user = true;
                console.log(this.$.globals.values.user);
            },

            signIn: function () {
                this.$.ajaxSignIn.go();
            },

            signInResponse: function (event, result) {
                if (!result.response.statusCode) {
                    this.$.globals.values.user = result.response;
                } else {
                    this.$.globals.values.user = null;
                }
            }

        });
    </script>

</polymer-element>